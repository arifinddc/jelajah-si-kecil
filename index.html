<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Jelajah Si Kecil</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        
        body, html { 
            margin: 0; padding: 0; 
            height: 100%; width: 100%;
            overflow: hidden; 
            font-family: 'Fredoka', sans-serif; 
            background: #0F172A;
            -webkit-user-select: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        #root { height: 100%; width: 100%; }

        .app-container {
            position: absolute; 
            inset: 0;
            height: 100dvh; 
            display: flex; 
            flex-direction: column;
            background: linear-gradient(180deg, #1E293B 0%, #0F172A 100%);
            max-width: 500px; 
            margin: 0 auto;
            border-left: 2px solid #F59E0B; 
            border-right: 2px solid #F59E0B;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .hud-bar {
            height: 55px; 
            flex-shrink: 0;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 1rem; background: rgba(15, 23, 42, 0.95);
            border-bottom: 3px solid #F59E0B; z-index: 20;
        }

        .game-area {
            flex: 1; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: space-between; 
            padding: 0.75rem; 
            width: 100%; 
            overflow: hidden;
        }

        .instruction-text {
            font-size: 1.15rem;
            font-weight: 700;
            color: #F1F5F9;
            line-height: 1.2;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Target Display diperkecil agar tidak memakan tempat */
        .target-display {
            width: 110px; height: 110px;
            background: #1e293b; border: 3px dashed #64748b; border-radius: 1.25rem;
            display: flex; align-items: center; justify-content: center;
            font-size: 3.5rem; 
            margin: 0.5rem 0;
        }
        .target-display.solid { border-style: solid; border-color: #F59E0B; background: #334155; }

        /* Grid Jawaban diperkecil kotaknya */
        .option-grid { 
            display: grid; 
            gap: 10px; 
            width: 100%; 
            max-width: 320px;
            margin-bottom: 0.5rem;
        }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        
        .btn-choice {
            background: white; border: 3px solid #CBD5E1;
            border-radius: 1rem; 
            aspect-ratio: 1.35; /* Lebih pipih agar muat secara vertikal */
            display: flex; align-items: center; justify-content: center;
            font-size: 2.25rem; transition: transform 0.1s;
            box-shadow: 0 4px 0 #94A3B8; color: #0F172A; 
            width: 100%;
        }
        .btn-choice:active { transform: scale(0.95); box-shadow: 0 1px 0 #94A3B8; }
        .btn-choice.correct { background: #4ADE80; border-color: #166534; box-shadow: 0 4px 0 #166534; }
        .btn-choice.wrong { background: #F87171; border-color: #991B1B; box-shadow: 0 4px 0 #991B1B; opacity: 0.5; }

        .menu-btn {
            width: 100%; background: #F59E0B; color: white;
            padding: 1rem; margin-bottom: 0.8rem;
            border-radius: 1rem; font-size: 1.2rem; font-weight: bold;
            box-shadow: 0 4px 0 #B45309; transition: all 0.1s;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const generateDB = () => {
            const numbers = Array.from({length: 50}, (_, i) => ({ id: `n${i}`, icon: `${i}`, val: i, type: 'number' }));
            const emojis = [
                { i: "üê±", t: "animal" }, { i: "üê∂", t: "animal" }, { i: "ü¶Å", t: "animal" }, { i: "üçé", t: "food" }, 
                { i: "üçå", t: "food" }, { i: "üçá", t: "food" }, { i: "üöó", t: "vehicle" }, { i: "üöÄ", t: "vehicle" }, 
                { i: "‚öΩ", t: "sport" }, { i: "üèÄ", t: "sport" }, { i: "üî¥", t: "color" }, { i: "üîµ", t: "color" }
            ];
            return { numbers, emojis: emojis.map((e, idx) => ({ id: `e${idx}`, icon: e.i, type: e.t })) };
        };

        const DB = generateDB();

        const App = () => {
            const [screen, setScreen] = useState('menu');
            const [userData, setUserData] = useState(() => {
                const saved = localStorage.getItem('jelajah_si_kecil_save');
                return saved ? JSON.parse(saved) : { score: 0, lives: 3, levelIdx: 0, streak: 0, lastLifeLost: null };
            });
            const [puzzle, setPuzzle] = useState(null);
            const [feedback, setFeedback] = useState(null);
            const [regenTimer, setRegenTimer] = useState("");

            const getDifficulty = (level) => {
                if (level < 5) return { maxNum: 10, types: ['match', 'shadow'], distractors: 1 };
                if (level < 15) return { maxNum: 20, types: ['match', 'shadow', 'count', 'sudoku'], distractors: 3 };
                return { maxNum: 50, types: ['sequence', 'odd', 'count', 'sudoku', 'match'], distractors: 3 };
            };

            const generateMission = () => {
                const diff = getDifficulty(userData.levelIdx);
                const type = diff.types[Math.floor(Math.random() * diff.types.length)];
                let target, options = [], meta = {}, instruction = "";
                const getRand = (arr) => arr[Math.floor(Math.random() * arr.length)];
                const getDist = (arr, id, count) => arr.filter(a => a.id !== id).sort(()=>0.5-Math.random()).slice(0, count);

                if (type === 'match' || type === 'shadow') {
                    const pool = [...DB.emojis, ...DB.numbers.slice(0, diff.maxNum)];
                    target = getRand(pool);
                    options = [target, ...getDist(pool, target.id, diff.distractors)];
                    instruction = type === 'match' ? "Cari yang sama persis!" : "Tebak bayangan siapa?";
                } else if (type === 'count') {
                    const num = Math.floor(Math.random() * 3) + 1; 
                    const item = getRand(DB.emojis.filter(e => e.type !== 'color'));
                    const iconStr = Array(num).fill(item.icon).join("");
                    target = { id: 'c_t', val: num }; 
                    const correctNum = DB.numbers.find(n => n.val === num);
                    options = [correctNum, ...getDist(DB.numbers.slice(1, 6), `n${num}`, diff.distractors)];
                    instruction = "Ada berapa jumlahnya?"; 
                    meta = { isCount: true, display: iconStr }; 
                } else if (type === 'sequence') {
                    const a = getRand(DB.emojis); const b = getRand(DB.emojis.filter(e => e.id !== a.id));
                    target = b; meta = { seq: [a.icon, b.icon, a.icon, "?"] };
                    options = [b, ...getDist(DB.emojis, b.id, diff.distractors)];
                    instruction = "Apa urutan selanjutnya?";
                } else if (type === 'odd') {
                    const pool = DB.emojis.filter(e => e.type === 'animal');
                    const common = getRand(pool); const odd = getRand(pool.filter(e => e.id !== common.id));
                    target = odd; options = [common, common, common, odd]; 
                    instruction = "Mana yang paling beda?";
                } else if (type === 'sudoku') {
                    const colors = DB.emojis.filter(e => e.type === 'color').sort(()=>0.5-Math.random());
                    target = colors[1]; meta = { grid: [colors[0].icon, colors[1].icon, colors[1].icon, "?"] };
                    options = [colors[0], colors[1]]; instruction = "Warna kotak tidak boleh sama!";
                }
                setPuzzle({ type, target, options: options.sort(()=>0.5-Math.random()), meta, instruction });
            };

            useEffect(() => {
                const timer = setInterval(() => {
                    if (userData.lives < 3 && userData.lastLifeLost) {
                        const diff = Date.now() - userData.lastLifeLost;
                        if (diff >= 600000) setUserData(p => ({ ...p, lives: Math.min(p.lives + 1, 3), lastLifeLost: p.lives+1<3?Date.now():null }));
                        else setRegenTimer(`${Math.floor((600000-diff)/60000)}:${Math.floor(((600000-diff)%60000)/1000).toString().padStart(2,'0')}`);
                    } else setRegenTimer("");
                }, 1000);
                return () => clearInterval(timer);
            }, [userData]);

            useEffect(() => { localStorage.setItem('jelajah_si_kecil_save', JSON.stringify(userData)); }, [userData]);

            const handleAnswer = (opt) => {
                if (feedback) return;
                if (opt.id === puzzle.target.id || opt.val === puzzle.target.val) {
                    setFeedback('correct');
                    setTimeout(() => {
                        setUserData(p => ({ ...p, score: p.score+10, levelIdx: p.levelIdx+1, streak: p.streak+1 }));
                        setScreen('result'); setFeedback(null);
                    }, 500);
                } else {
                    setFeedback('wrong');
                    setUserData(p => ({ ...p, lives: Math.max(0, p.lives-1), streak: 0, lastLifeLost: p.lives===3?Date.now():p.lastLifeLost }));
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            if (screen === 'menu') return (
                <div className="app-container p-6 justify-center items-center text-center">
                    <div className="text-8xl mb-4">üß©</div>
                    <h1 className="text-3xl font-black text-white mb-2 uppercase">Jelajah Si Kecil</h1>
                    <p className="text-amber-500 mb-8 font-bold uppercase tracking-widest text-xs">Versi 15.0</p>
                    <button onClick={() => { setUserData({...userData, levelIdx:0, score:0, lives:3}); setScreen('game'); setTimeout(generateMission, 50); }} className="menu-btn">MULAI BARU</button>
                    <button onClick={() => { setScreen('game'); setTimeout(generateMission, 50); }} className={`menu-btn bg-slate-700 ${userData.levelIdx===0?'opacity-50':''}`}>LANJUTKAN</button>
                    <div className="text-slate-500 text-xs mt-4">Energi: {userData.lives}/3 ‚Ä¢ {regenTimer}</div>
                </div>
            );

            if (screen === 'result') return (
                <div className="app-container p-6 justify-center items-center text-center bg-slate-900">
                    <div className="text-7xl mb-4">üåü</div>
                    <h2 className="text-2xl font-bold text-white mb-6">Pintar Sekali!</h2>
                    <button onClick={() => { setScreen('game'); generateMission(); }} className="menu-btn bg-green-600">LANJUT</button>
                </div>
            );

            return (
                <div className="app-container">
                    <div className="hud-bar">
                        <div className="flex flex-col items-center"><span className="text-xl">‚ù§Ô∏è {userData.lives}</span><span className="text-[9px] text-amber-500">{regenTimer}</span></div>
                        <div className="text-center"><span className="text-xs text-slate-400 font-bold uppercase">Level {userData.levelIdx + 1}</span></div>
                        <div className="bg-amber-500 text-white px-3 py-1 rounded-full font-bold text-sm">‚≠ê {userData.score}</div>
                    </div>
                    <div className="game-area">
                        {userData.lives <= 0 ? (
                            <div className="text-center"><h2 className="text-xl text-white font-bold mb-4">Energi Habis!</h2><button onClick={() => setScreen('menu')} className="menu-btn">Kembali</button></div>
                        ) : puzzle ? (
                            <>
                                <h2 className="instruction-text">{puzzle.instruction}</h2>
                                <div className="flex-1 flex flex-col items-center justify-center w-full">
                                    {puzzle.type === 'sudoku' ? (
                                        <div className="grid grid-cols-2 gap-2 bg-amber-500 p-2 rounded-xl">{puzzle.meta.grid.map((c,i)=><div key={i} className="w-12 h-12 bg-slate-800 rounded-lg flex items-center justify-center text-2xl">{c}</div>)}</div>
                                    ) : puzzle.type === 'sequence' ? (
                                        <div className="flex gap-2 bg-slate-800 p-3 rounded-xl border border-slate-600">{puzzle.meta.seq.map((c,i)=><div key={i} className="w-10 h-10 bg-slate-700 rounded-lg flex items-center justify-center text-xl text-white">{c}</div>)}</div>
                                    ) : puzzle.meta?.isCount ? (
                                        <div className="target-display solid text-3xl">{puzzle.meta.display}</div>
                                    ) : (
                                        <div className={`target-display ${puzzle.type==='match'?'solid':''}`}>
                                            {puzzle.type === 'shadow' ? <span className="grayscale brightness-0 opacity-10">{puzzle.target.icon}</span> : <span>{puzzle.target.icon}</span>}
                                        </div>
                                    )}
                                </div>
                                <div className={`option-grid grid-2`}>
                                    {puzzle.options.map((opt, i) => (
                                        <button key={i} onClick={() => handleAnswer(opt)} className={`btn-choice ${feedback==='correct' && (opt.id===puzzle.target.id || opt.val===puzzle.target.val) ? 'correct' : ''} ${feedback==='wrong' && opt.id!==puzzle.target.id ? 'wrong' : ''}`}>{opt.icon}</button>
                                    ))}
                                </div>
                            </>
                        ) : null}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
