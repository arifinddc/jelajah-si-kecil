<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Akademi Sage: Phi Brain Junior</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap');
        
        /* Reset & Base */
        body, html { 
            margin: 0; padding: 0; 
            height: 100%; width: 100%;
            overflow: hidden; 
            font-family: 'Fredoka', sans-serif; 
            background: #0F172A; /* Background luar (untuk PC) */
        }

        #root { height: 100%; width: 100%; }

        /* Container Utama HP */
        .app-container {
            position: fixed;
            inset: 0; /* Full Screen mutlak */
            display: flex;
            flex-direction: column;
            background: #1E293B; /* Warna Slate-800 */
            max-width: 500px; /* Batas lebar untuk tablet/PC */
            margin: 0 auto;
            border-left: 2px solid #F59E0B;
            border-right: 2px solid #F59E0B;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* Styling Elemen Game */
        .hud-bar {
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1.5rem;
            background: #0F172A;
            border-bottom: 3px solid #F59E0B;
            flex-shrink: 0;
        }

        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Rata tengah Vertikal */
            padding: 20px;
            width: 100%;
            text-align: center; /* Rata tengah Horizontal */
        }

        /* Puzzle Styles */
        .sudoku-grid { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; 
            background: #F59E0B; padding: 10px; border-radius: 1rem; 
        }
        .sudoku-cell { 
            width: 70px; height: 70px; background: #334155; 
            border-radius: 0.5rem; display: flex; align-items: center; 
            justify-content: center; font-size: 2.5rem; 
        }
        
        .symmetry-box { 
            width: 180px; height: 180px; background: #334155; 
            border-radius: 1.5rem; overflow: hidden; border: 4px solid #94A3B8; 
            display: flex; align-items: center; justify-content: center;
        }
        .symmetry-half { font-size: 9rem; clip-path: inset(0 50% 0 0); transform: scale(1.4); }
        .symmetry-option { font-size: 4rem; clip-path: inset(0 0 0 50%); transform: scale(1.6) translateX(-25%); }

        /* Target Slot (Kotak Tengah) */
        .target-slot { 
            width: 140px; height: 140px; 
            background: #1e293b; 
            border: 4px dashed #475569; 
            border-radius: 2rem; 
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 2rem;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }

        /* Grid Jawaban */
        .option-grid { 
            display: grid; 
            gap: 15px; 
            width: 100%; 
            max-width: 350px; /* Agar tombol tidak terlalu lebar di tablet */
        }
        
        .btn-choice { 
            background: #334155; 
            border: 4px solid #475569; 
            border-radius: 1.5rem; 
            aspect-ratio: 1; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 3rem; 
            transition: transform 0.1s;
            box-shadow: 0 4px 0 #1e293b;
        }
        .btn-choice:active { transform: scale(0.95); box-shadow: 0 2px 0 #1e293b; }
        .btn-choice.correct { background: #22C55E; border-color: #166534; }
        .btn-choice.wrong { background: #EF4444; border-color: #991B1B; }

        /* Helpers */
        .glow-gold { border-color: #F59E0B; box-shadow: 0 0 25px rgba(245, 158, 11, 0.4); }
        button { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- DATABASE ASET (Disederhanakan & Valid) ---
        const ASSETS = {
            letters: [
                { id: "la", icon: "üÖ∞Ô∏è" }, { id: "lb", icon: "üÖ±Ô∏è" }, { id: "lc", icon: "üÖ≤" }, 
                { id: "ld", icon: "üÖ≥" }, { id: "le", icon: "üÖ¥" }
            ],
            numbers: [
                { id: "n1", icon: "1Ô∏è‚É£", val: 1 }, { id: "n2", icon: "2Ô∏è‚É£", val: 2 }, 
                { id: "n3", icon: "3Ô∏è‚É£", val: 3 }, { id: "n4", icon: "4Ô∏è‚É£", val: 4 }
            ],
            misc: [
                { id: "a1", icon: "üê±", name: "Kucing", sound: "Meong" },
                { id: "a2", icon: "üê∂", name: "Anjing", sound: "Guk Guk" },
                { id: "f1", icon: "üçé", name: "Apel", color: "merah", type: "food" },
                { id: "f2", icon: "üçå", name: "Pisang", color: "kuning", type: "food" },
                { id: "c1", icon: "üî¥", type: "color" }, 
                { id: "c2", icon: "üîµ", type: "color" }
            ]
        };

        const SCHEMAS = ["phi_matching", "phi_shadow", "phi_symmetry", "phi_sudoku", "phi_sound", "phi_counting"];

        const App = () => {
            const [gameState, setGameState] = useState('idle');
            const [userData, setUserData] = useState(() => {
                const saved = localStorage.getItem('phi_sage_v12_4');
                return saved ? JSON.parse(saved) : { score: 0, lives: 3, levelIdx: 0, streak: 0, lastLifeLost: null };
            });

            const [currentPuzzle, setCurrentPuzzle] = useState(null);
            const [feedback, setFeedback] = useState(null); // 'correct' | 'wrong' | null
            const [regenTimer, setRegenTimer] = useState("");
            const [showBonus, setShowBonus] = useState(false);

            // --- AUDIO ENGINE ---
            const speak = (txt) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const u = new SpeechSynthesisUtterance(txt);
                    u.lang = 'id-ID'; u.rate = 0.9;
                    window.speechSynthesis.speak(u);
                }
            };

            const playTone = (isCorrect) => {
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain); gain.connect(ctx.destination);
                    osc.frequency.setValueAtTime(isCorrect ? 880 : 220, ctx.currentTime);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    osc.start(); osc.stop(ctx.currentTime + 0.3);
                } catch(e) {}
            };

            // --- LOGIC REGENERASI NYAWA ---
            useEffect(() => {
                const timer = setInterval(() => {
                    if (userData.lives < 3 && userData.lastLifeLost) {
                        const diff = Date.now() - userData.lastLifeLost;
                        if (diff >= 600000) {
                            setUserData(p => ({ ...p, lives: Math.min(p.lives + 1, 3), lastLifeLost: p.lives+1 < 3 ? Date.now() : null }));
                        } else {
                            const rem = 600000 - diff;
                            setRegenTimer(`${Math.floor(rem/60000)}:${Math.floor((rem%60000)/1000).toString().padStart(2,'0')}`);
                        }
                    } else setRegenTimer("");
                }, 1000);
                return () => clearInterval(timer);
            }, [userData.lives, userData.lastLifeLost]);

            useEffect(() => { localStorage.setItem('phi_sage_v12_4', JSON.stringify(userData)); }, [userData]);

            // --- GENERATOR LEVEL (Logic Inti) ---
            const nextMisi = () => {
                if (userData.lives <= 0) return speak("Energi habis, istirahat dulu ya.");
                
                const type = SCHEMAS[Math.floor(Math.random() * SCHEMAS.length)];
                let target, options = [], meta = {}, instruction = "";

                // Logic Spesifik per Game
                if (type === "phi_counting") {
                    // FIX: Pastikan yang dihitung adalah APEL (f1), bukan random
                    const count = Math.floor(Math.random() * 3) + 1; // 1, 2, atau 3
                    const item = ASSETS.misc.find(a => a.id === "f1"); // Apel
                    
                    // Generate string icon (misal: "üçéüçé")
                    const correctIcon = Array(count).fill(item.icon).join("");
                    const wrongIcon = Array(count + 1).fill(item.icon).join("");

                    target = { id: "correct", icon: correctIcon };
                    options = [target, { id: "wrong", icon: wrongIcon }];
                    
                    // FIX: Template Literal langsung agar {param} tidak error
                    instruction = `Ketuk yang isinya ${count} benda!`;
                }
                else if (type === "phi_sudoku") {
                    const c = ASSETS.misc.filter(a => a.type === "color").sort(() => 0.5 - Math.random());
                    target = c[0];
                    meta = { grid: [c[0].icon, c[1].icon, c[1].icon, "?"] };
                    options = [c[0], c[1]];
                    instruction = "Lengkapi kotak agar warnanya beda!";
                }
                else if (type === "phi_sound") {
                    const animals = ASSETS.misc.filter(a => a.type === "animal").sort(() => 0.5 - Math.random());
                    target = animals[0];
                    options = [target, animals[1], animals[2]].filter(Boolean);
                    instruction = `Siapa yang suaranya ${target.sound}?`;
                }
                else if (type === "phi_symmetry") {
                    target = ASSETS.misc[Math.floor(Math.random() * ASSETS.misc.length)];
                    const others = ASSETS.misc.filter(a => a.id !== target.id).slice(0, 1);
                    options = [target, ...others];
                    instruction = "Cari belahan gambar yang cocok!";
                }
                else {
                    // Matching & Shadow
                    const pool = [...ASSETS.misc, ...ASSETS.numbers];
                    target = pool[Math.floor(Math.random() * pool.length)];
                    const others = pool.filter(a => a.id !== target.id).sort(() => 0.5 - Math.random()).slice(0, 1); // 2 Pilihan biar mudah
                    options = [target, ...others];
                    instruction = type === "phi_shadow" ? "Tebak bayangan siapa ini?" : "Cari yang sama persis!";
                }

                setCurrentPuzzle({ type, target, options: options.sort(() => 0.5 - Math.random()), meta, instruction });
                setGameState('playing');
                speak(instruction);
            };

            const handleAnswer = (opt) => {
                if (feedback) return;
                const isCorrect = opt.id === currentPuzzle.target.id;

                if (isCorrect) {
                    playTone(true); setFeedback('correct');
                    setTimeout(() => {
                        setUserData(p => ({ ...p, score: p.score + 10, levelIdx: p.levelIdx + 1, streak: p.streak + 1 }));
                        setGameState('idle'); setFeedback(null);
                    }, 1000);
                } else {
                    playTone(false); setFeedback('wrong');
                    setUserData(p => ({ ...p, lives: Math.max(0, p.lives - 1), streak: 0, lastLifeLost: p.lives === 3 ? Date.now() : p.lastLifeLost }));
                    speak("Salah, coba lagi!");
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            // --- RENDER ---
            return (
                <div className="app-container">
                    {/* HUD Header */}
                    <div className="hud-bar">
                        <div className="flex flex-col items-center">
                            <span className="text-2xl drop-shadow-md">‚ù§Ô∏è {userData.lives}</span>
                            <span className="text-[10px] text-amber-500 font-bold">{regenTimer}</span>
                        </div>
                        <div className="flex flex-col items-center">
                             <div className="text-xs text-slate-400 font-bold tracking-widest uppercase">Misi {userData.levelIdx + 1}</div>
                             <div className="h-1 w-16 bg-slate-700 rounded-full mt-1 overflow-hidden">
                                <div className="h-full bg-amber-500 transition-all" style={{width: `${(userData.streak % 10) * 10}%`}}></div>
                             </div>
                        </div>
                        <div className="bg-amber-500 text-white px-3 py-1 rounded-full font-bold shadow-lg border border-amber-400">
                            ‚≠ê {userData.score}
                        </div>
                    </div>

                    {/* Main Area (Centered via Flexbox) */}
                    <div className="main-area">
                        {gameState === 'idle' && (
                            <div className="flex flex-col items-center animate-in zoom-in duration-300 w-full">
                                <div className="text-8xl mb-6 filter drop-shadow-xl animate-bounce">üß©</div>
                                <h1 className="text-3xl font-black text-white tracking-tight mb-2">AKADEMI SAGE</h1>
                                <p className="text-slate-400 mb-8 text-sm">Edisi Junior v12.4</p>
                                
                                <button onClick={nextMisi} className="w-full max-w-xs bg-amber-500 hover:bg-amber-600 text-white py-4 rounded-2xl text-xl font-bold shadow-[0_4px_0_rgb(180,83,9)] active:translate-y-1 active:shadow-none transition-all">
                                    PECAHKAN
                                </button>
                            </div>
                        )}

                        {gameState === 'playing' && currentPuzzle && (
                            <div className="flex flex-col items-center w-full h-full justify-between py-4">
                                {/* Instruksi */}
                                <h2 className="text-xl font-bold text-slate-100 mb-4 px-2 leading-tight">
                                    {currentPuzzle.instruction}
                                </h2>
                                
                                {/* Area Soal */}
                                <div className="flex-1 flex items-center justify-center w-full">
                                    {currentPuzzle.type === "phi_sudoku" ? (
                                        <div className="sudoku-grid">
                                            {currentPuzzle.meta.grid.map((cell, i) => <div key={i} className="sudoku-cell">{cell}</div>)}
                                        </div>
                                    ) : currentPuzzle.type === "phi_symmetry" ? (
                                        <div className="symmetry-box">
                                            <span className="symmetry-half">{currentPuzzle.target.icon}</span>
                                        </div>
                                    ) : (
                                        <div className="target-slot">
                                            {currentPuzzle.type === "phi_shadow" ? 
                                                <span className="text-8xl grayscale brightness-0 opacity-10">{currentPuzzle.target.icon}</span> : 
                                                <span className="text-7xl animate-pulse">‚ùì</span>}
                                        </div>
                                    )}
                                </div>

                                {/* Pilihan Jawaban */}
                                <div className={`option-grid ${currentPuzzle.options.length > 2 ? 'grid-cols-2' : 'grid-cols-2'}`}>
                                    {currentPuzzle.options.map((opt, i) => (
                                        <button key={i} onClick={() => handleAnswer(opt)} 
                                            className={`btn-choice ${feedback === 'correct' && opt.id === currentPuzzle.target.id ? 'correct' : ''} ${feedback === 'wrong' && opt.id !== currentPuzzle.target.id ? 'opacity-50' : ''}`}>
                                            <span className={currentPuzzle.type === "phi_symmetry" ? 'symmetry-option' : ''}>{opt.icon}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
