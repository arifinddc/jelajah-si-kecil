<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Akademi Sage: Phi Brain Junior</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap');

        body, html {
            margin: 0; padding: 0;
            height: 100vh; overflow: hidden;
            font-family: 'Fredoka', sans-serif;
            background: #0F172A; /* Warna Tema Phi Brain */
        }

        #root { height: 100%; }

        .game-container {
            height: 100vh;
            max-width: 500px;
            margin: 0 auto;
            background: #1E293B;
            display: flex;
            flex-direction: column;
            color: white;
            position: relative;
            border-left: 3px solid #F59E0B;
            border-right: 3px solid #F59E0B;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* Puzzle: Sudoku 2x2 */
        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            background: #F59E0B;
            padding: 12px;
            border-radius: 1.5rem;
        }

        .sudoku-cell {
            width: 70px; height: 70px;
            background: #334155;
            border-radius: 1rem;
            display: flex; align-items: center; justify-content: center;
            font-size: 2.5rem;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* Puzzle: Symmetry */
        .symmetry-box {
            width: 180px; height: 180px;
            background: #334155;
            border-radius: 2rem;
            overflow: hidden;
            border: 4px solid #475569;
            display: flex; align-items: center; justify-content: center;
        }

        .symmetry-half {
            font-size: 10rem;
            clip-path: inset(0 50% 0 0); /* Potong sisi kanan */
            transform: scale(1.4);
        }

        .symmetry-option {
            font-size: 4rem;
            clip-path: inset(0 0 0 50%); /* Potong sisi kiri */
            transform: scale(1.6) translateX(-25%);
        }

        /* Buttons & HUD */
        .btn-choice {
            background: #334155;
            border: 3px solid #475569;
            border-radius: 1.5rem;
            aspect-ratio: 1;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn-choice:active { transform: scale(0.9); }
        .glow-gold { border-color: #F59E0B; box-shadow: 0 0 15px #F59E0B; background: #451a03; }

        .bonus-overlay {
            background: rgba(245, 158, 11, 0.95);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        button { touch-action: manipulation; user-select: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- DATASET LENGKAP (Embed Langsung Agar Tidak Blank) ---
        const MASTER_DATA = {
            assets: [
                /* ALFABET A-Z */
                { id: "la", icon: "üÖ∞Ô∏è", name: "A", type: "letter" }, { id: "lb", icon: "üÖ±Ô∏è", name: "B", type: "letter" },
                { id: "lc", icon: "üÖ≤", name: "C", type: "letter" }, { id: "ld", icon: "üÖ≥", name: "D", type: "letter" },
                { id: "le", icon: "üÖ¥", name: "E", type: "letter" }, { id: "lz", icon: "üÜè", name: "Z", type: "letter" },
                /* ANGKA 0-9 */
                { id: "n0", icon: "0Ô∏è‚É£", val: 0, type: "number" }, { id: "n1", icon: "1Ô∏è‚É£", val: 1, type: "number" },
                { id: "n2", icon: "2Ô∏è‚É£", val: 2, type: "number" }, { id: "n3", icon: "3Ô∏è‚É£", val: 3, type: "number" },
                { id: "n4", icon: "4Ô∏è‚É£", val: 4, type: "number" }, { id: "n5", icon: "5Ô∏è‚É£", val: 5, type: "number" },
                { id: "n6", icon: "‚öÄ", val: 1, type: "dice" }, { id: "n7", icon: "‚öÅ", val: 2, type: "dice" },
                /* BENDA & HEWAN */
                { id: "a1", icon: "üê±", name: "Kucing", type: "animal", sound: "Meong" },
                { id: "a2", icon: "üê∂", name: "Anjing", type: "animal", sound: "Guk Guk" },
                { id: "a3", icon: "ü¶Å", name: "Singa", type: "animal", sound: "Aummm" },
                { id: "a4", icon: "üêò", name: "Gajah", type: "animal", sound: "Preettt" },
                { id: "f1", icon: "üçé", name: "Apel", type: "food", color: "merah" },
                { id: "f2", icon: "üçå", name: "Pisang", type: "food", color: "kuning" },
                { id: "c1", icon: "üî¥", type: "color" }, { id: "c2", icon: "üîµ", type: "color" }
            ],
            schemas: [
                { type: "phi_matching", instruction: "Cari yang sama persis ya!" },
                { type: "phi_shadow", instruction: "Tebak bayangan siapa ini?" },
                { type: "phi_symmetry", instruction: "Cari belahan gambar yang cocok!" },
                { type: "phi_sudoku", instruction: "Lengkapi kotak agar warnanya beda!" },
                { type: "phi_sound", instruction: "Siapa yang bunyinya {param}?" },
                { type: "phi_counting", instruction: "Ketuk yang isinya {param} benda!" }
            ]
        };

        const App = () => {
            const [gameState, setGameState] = useState('idle');
            const [userData, setUserData] = useState(() => {
                const saved = localStorage.getItem('phi_sage_v12');
                return saved ? JSON.parse(saved) : { score: 0, lives: 3, levelIdx: 0, streak: 0, lastLifeLost: null };
            });

            const [currentPuzzle, setCurrentPuzzle] = useState(null);
            const [feedback, setFeedback] = useState(null);
            const [regenTimer, setRegenTimer] = useState("");
            const [showBonus, setShowBonus] = useState(false);

            // --- SUARA & FEEDBACK ---
            const speak = (txt) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(txt);
                u.lang = 'id-ID'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            };

            const playTone = (isCorrect) => {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain); gain.connect(ctx.destination);
                osc.frequency.setValueAtTime(isCorrect ? 880 : 220, ctx.currentTime);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                osc.start(); osc.stop(ctx.currentTime + 0.3);
            };

            // --- REGENERASI NYAWA ---
            useEffect(() => {
                const interval = setInterval(() => {
                    if (userData.lives < 3 && userData.lastLifeLost) {
                        const diff = Date.now() - userData.lastLifeLost;
                        if (diff >= 600000) { // 10 Menit
                            setUserData(p => ({ ...p, lives: Math.min(p.lives + 1, 3), lastLifeLost: p.lives+1 < 3 ? Date.now() : null }));
                        } else {
                            const rem = 600000 - diff;
                            const m = Math.floor(rem/60000);
                            const s = Math.floor((rem%60000)/1000).toString().padStart(2,'0');
                            setRegenTimer(`${m}:${s}`);
                        }
                    } else setRegenTimer("");
                }, 1000);
                return () => clearInterval(interval);
            }, [userData.lives, userData.lastLifeLost]);

            useEffect(() => { localStorage.setItem('phi_sage_v12', JSON.stringify(userData)); }, [userData]);

            // --- PUZZLE GENERATOR ---
            const nextMisi = () => {
                if (userData.lives <= 0) return speak("Energi habis, istirahat dulu ya detektif.");
                
                const schema = MASTER_DATA.schemas[Math.floor(Math.random() * MASTER_DATA.schemas.length)];
                const assets = MASTER_DATA.assets;
                let target, options = [], meta = {};

                if (schema.type === "phi_sudoku") {
                    const colors = assets.filter(a => a.type === "color").sort(() => 0.5 - Math.random());
                    target = colors[0];
                    meta = { grid: [colors[0].icon, colors[1].icon, colors[1].icon, "?"] };
                    options = [colors[0], colors[1]];
                } 
                else if (schema.type === "phi_sound") {
                    target = assets.filter(a => a.sound).sort(() => 0.5 - Math.random())[0];
                    schema.instruction = `Siapa yang suaranya ${target.sound}?`;
                    options = [target, ...assets.filter(a => a.id !== target.id).slice(0, 2)];
                }
                else {
                    target = assets[Math.floor(Math.random() * assets.length)];
                    options = [target, ...assets.filter(a => a.id !== target.id).slice(0, 2)];
                }

                setCurrentPuzzle({ ...schema, target, options: options.sort(() => 0.5 - Math.random()), meta });
                setGameState('playing');
                speak(schema.instruction);
            };

            const handleAnswer = (opt) => {
                if (feedback) return;
                const isCorrect = opt.id === currentPuzzle.target.id;

                if (isCorrect) {
                    playTone(true); setFeedback('correct');
                    const newStreak = userData.streak + 1;
                    const bonus = (newStreak === 10) ? 50 : 0;
                    if (newStreak === 10) setShowBonus(true);
                    
                    setTimeout(() => {
                        setUserData(p => ({ ...p, score: p.score + 10 + bonus, levelIdx: p.levelIdx + 1, streak: newStreak === 10 ? 0 : newStreak }));
                        setGameState('idle'); setFeedback(null); setShowBonus(false);
                    }, 1500);
                } else {
                    playTone(false); setFeedback('wrong');
                    setUserData(p => ({ ...p, lives: Math.max(0, p.lives - 1), streak: 0, lastLifeLost: p.lives === 3 ? Date.now() : p.lastLifeLost }));
                    speak("Coba lagi!");
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            return (
                <div className="game-container">
                    {/* HUD Bar */}
                    <div className="p-4 flex justify-between items-center bg-slate-900 border-b-2 border-amber-600">
                        <div className="flex flex-col items-center">
                            <span className="text-2xl">‚ù§Ô∏è {userData.lives}</span>
                            <span className="text-[10px] text-amber-500 font-bold">{regenTimer}</span>
                        </div>
                        <div className="text-center">
                            <div className="text-[10px] text-slate-500 uppercase tracking-widest">Puzzle {userData.levelIdx + 1}</div>
                            <div className="w-16 h-1 bg-slate-800 rounded-full mt-1 overflow-hidden">
                                <div className="h-full bg-amber-500" style={{width: `${userData.streak*10}%`}}></div>
                            </div>
                        </div>
                        <div className="bg-amber-600 px-3 py-1 rounded-full font-bold shadow-md">‚≠ê {userData.score}</div>
                    </div>

                    {/* Content */}
                    <div className="flex-1 flex flex-col items-center justify-center p-6 text-center">
                        {gameState === 'idle' && (
                            <div className="animate-in zoom-in duration-300">
                                <div className="text-8xl mb-8 drop-shadow-lg">üß©</div>
                                <h1 className="text-2xl font-black text-amber-500 tracking-widest mb-10">AKADEMI SAGE</h1>
                                <button onClick={nextMisi} className="bg-amber-600 text-white px-12 py-5 rounded-[2rem] text-2xl font-bold shadow-2xl active:scale-95 transition-transform">PECAHKAN</button>
                            </div>
                        )}

                        {gameState === 'playing' && currentPuzzle && (
                            <div className="w-full h-full flex flex-col justify-around py-4">
                                <h2 className="text-xl font-bold text-slate-300 px-2">{currentPuzzle.instruction}</h2>
                                
                                <div className="flex justify-center">
                                    {currentPuzzle.type === "phi_sudoku" ? (
                                        <div className="sudoku-grid">
                                            {currentPuzzle.meta.grid.map((cell, i) => (
                                                <div key={i} className="sudoku-cell">{cell}</div>
                                            ))}
                                        </div>
                                    ) : currentPuzzle.type === "phi_symmetry" ? (
                                        <div className="symmetry-box">
                                            <span className="symmetry-half">{currentPuzzle.target.icon}</span>
                                        </div>
                                    ) : (
                                        <div className="w-36 h-36 bg-slate-800 rounded-[2.5rem] flex items-center justify-center border-4 border-dashed border-slate-700 shadow-inner">
                                            {currentPuzzle.type === "phi_shadow" ? 
                                                <span className="text-8xl grayscale brightness-0 opacity-10">{currentPuzzle.target.icon}</span> : 
                                                <span className="text-7xl animate-pulse">‚ùì</span>}
                                        </div>
                                    )}
                                </div>

                                <div className="grid grid-cols-2 gap-4 w-full">
                                    {currentPuzzle.options.map((opt, i) => (
                                        <button key={i} onClick={() => handleAnswer(opt)} 
                                            className={`btn-choice ${feedback === 'correct' && opt.id === currentPuzzle.target.id ? 'glow-gold' : ''}`}>
                                            <span className={currentPuzzle.type === "phi_symmetry" ? 'symmetry-option' : ''}>{opt.icon}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {showBonus && (
                        <div className="absolute inset-0 z-50 flex flex-col items-center justify-center text-white bonus-overlay">
                            <div className="text-9xl mb-4 animate-bounce">üèÜ</div>
                            <h2 className="text-4xl font-black">BONUS +50</h2>
                            <p className="text-xl">Detektif Pintar!</p>
                        </div>
                    )}

                    <div className="p-2 text-center text-[9px] text-slate-600 font-bold uppercase tracking-[0.3em]">Phi Junior v12.1 ‚Ä¢ Sage Engine</div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
